---
title: 深拷贝和浅拷贝的区别
copyright: true
date: 2019-05-14 22:55:24
categories: 学习笔记
tags:
 - C++
 - 经典案例
---

虽然网上大家们都说浅拷贝和深拷贝本不是C++原本的概念，根本都是胡乱撤出来的概念，但我感觉还是有必要写这一篇文章，并且以此作为标题。

<!--more-->

# 浅拷贝

我们都知道,C++在实例化一个类对象时，会自动调用它的拷贝构造函数。

**那么浅拷贝就是在你没有创建自定义拷贝构造函数时执行的默认的拷贝构造函数。**

那什么是拷贝构造函数呢?

**拷贝构造函数是将对象的所有属性的值进行拷贝，并且赋值给要拷贝的对象**

下面看个例子:

~~~C++
#include <iostream>

using namespace std;

class Human {
public:
    string name;
    int age;

    //默认构造函数
    Human() {
        cout << "Human默认构造函数调用." << endl;
    }

    //有参构造函数
    Human(string f_name, int f_age) {
        name = f_name;
        age = f_age;
        cout << "Human有参构造函数调用." << endl;
    }

    //析构函数
    ~Human() {
        cout << "Human析构函数调用." << endl;
    }
};

int main() {
    Human h1("李四", 18);
    cout << h1.name << "的年龄为:" << h1.age << endl;
    //浅拷贝，编译器会自动将h1对象属性的值拷贝给h2
    Human h2(h1);
    cout << h2.name << "的年龄为:" << h2.age << endl;
    return 0;
}
~~~

输出结果为:

~~~
Human有参构造函数调用.
李四的年龄为:18
李四的年龄为:18
Human析构函数调用.
Human析构函数调用.

Process finished with exit code 0
~~~

根据上面的代码，我们可以看出h1对象所有属性的值都拷贝给了h2对象，但是我们并没有写相关的代码，**这是编译器帮我们实现的，也就是默认的拷贝构造函数，我们就称为浅拷贝。**

浅拷贝的具体代码实现是怎样的呢？请看下面的代码:

~~~C++
    //默认的拷贝构造函数
    Human(const Human & h){
        name = h.name;
        age = h.age;
    }
~~~

可与看出，它只是简单的将对象属性的值，进行拷贝。

大家思考一下，如果对象属性都是普通类型的变量，那么，这个浅拷贝是可以完美的完成这个任务的，但是如果对象属性含有引用变量或指针变量的话，那么这个浅拷贝，是否能正确的执行呢？

答案是否定的，下面看下深拷贝。


# 深拷贝

什么是深拷贝?

**深拷贝就是由程序员自定义的拷贝构造函数，并且能够处理浅拷贝所遇到的问题，也就是能够处理当浅拷贝遇到引用变量和指针变量时，无法完美处理的场景.**

下面的代码将体现，浅拷贝在遇到对象属性存在引用和指针变量时可能会出现的错误:

~~~C++
#include <iostream>

using namespace std;

class Human {
public:
    string name;
    int *age;

    //默认构造函数
    Human() {
        cout << "Human默认构造函数调用." << endl;
    }

    //有参构造函数
    Human(string f_name, int f_age) {
        name = f_name;
        //动态分配内存空间，将age的数据存入堆区
        age = new int(f_age);
        cout << "Human有参构造函数调用." << endl;
    }

    //析构函数
    ~Human() {
        //如果age指针变量是空，则释放
        if(age !=NULL){
            delete age;
            //防止指针变量成为野指针
            age = NULL;
        }
        cout << "Human析构函数调用." << endl;
    }
};

int main() {
    Human h1("李四", 18);
    cout << h1.name << "的年龄为:" <<*h1.age << endl;
    //浅拷贝，编译器会自动将h1对象属性的值拷贝给h2
    Human h2(h1);
    cout << h2.name << "的年龄为:" <<*h2.age << endl;
    return 0;
}
~~~

# 两者该如何选择?