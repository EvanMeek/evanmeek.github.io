---
title: 《GNU Emacs Lisp编程入门》读书笔记
copyright: true
date: 2019-12-21 16:17:25
categories: Lisp
tags:
 - EmacsLisp
---

借了本Elisp的书，不厚，200多页，大概一周就能看完吧!

<!--more-->

# 第一章 列表处理 #

列表是Lisp的基础。

## Lisp列表 ##
### 介绍 ###

简单的Lisp列表书写形式:

``` emacs-lisp
'(rose violet daisy buttercup) ;; => (rose violet daisy buttercup)
```

这个简单的列表中的四个元素时四种不同花的名称。**元素之间用空格隔开，并且被括号包住。**

另有一种在elisp中常用到的写法:

 
```emacs-lisp
(+ 2 2) ;; => 4
```

这种写法是Lisp的一个特性————**数据和代码都用相同的方式表示**。

**列表还允许嵌套列表，也就是说列表的元素也可以是列表**。

### Lisp原子 ###


原子意味着"不可再分"。例如刚刚列表内的'2'或者是'rose'等等，这些都是原子。

而列表却不是原子，因为**列表是由CAR和CDR与CONS构成的**。

技术上说，Lisp的列表有三种组合方式:
  * 括号和括号中由空格分隔的原子
  * 括号和括号中的其他列表
  * 括号和括号中的其他列表和原子

**一个列表可以仅有一个原子或完全没有原子**

无任何原子的列表称作空列表: `()`。你可以把空列表看为原子或列表。

*原子和列表可以被称为**符号表达式**(symbolic expression)，又可称为**S-表达式** *。

Lisp编程几乎都是关于列表中的符号的(且有时是关于数字的).

**双引号中的文本，都是单个原子**:`'(Info "Name:EvanMeek Age:18 Sex:Men**)`

这种被双引号括起来的文本叫做**字符串(string)**。

### 列表中的空格 ###

Lisp中括号的数量无关紧要。下面两个的列表是完全相同的。

括号多
``` emacs-lisp
'(1 2 3 4      5       6) ;; => (1 2 3 4 5 6)
```

括号少
``` emacs-lisp
'(1 2 3 4 5 6) ;; => (1 2 3 4 5 6)
```

适当的在列表中加入一些空格以及换行符可以提高可读性。


### GNU Emacs帮助你输入列表 ###

在Emacs中使用Emacs Lisp模式或Lisp交互模式输入Lisp表达式时可以用`Tab`按键使光标所在行自动缩排到适当的位置。要使某个区域的表达式都自动缩排的快捷键是`C-M-\`

并且Emacs会具有括号匹配的功能，以防你迷失在Lisp的括号海洋中。

有兴趣的可以看下这个知乎提问。<https://www.zhihu.com/question/356026550>

## 运行一个程序 ##

如果你想运行一段Lisp程序，那么计算机可能会做三种事:
* 只返回列表本身;
* 提示出错信息;
* 将列表中第一个符号作为要执行的命令;
大多数情况，我们希望计算机做的是第三件事

前面我们看到过一些列表的前面有一个单引号"'"，它其实是Lisp中的一个引用(quote)。它的作用是告诉Lisp不要做对这个列表做任何操作，只返回列表本身即可。

``` emacs-lisp
'(只是返回本身 即可) ;; => (只是返回本身 即可)
```

而如果列表前没有quote，那么列表的第一个符号就会称为Lisp要执行的命令(函数)，后面的则是函数的参数。

``` emacs-lisp
(+ 1 2 3 4) ;; => 10
```

Emacs中可以将光标放置一对S-表达式后按 `C-x C-e`就会将表达式读入至Lisp解释器中，进行解释，将结果输出至回显区，英文叫 `mini buffer`。

也可以对原子(没有被括号括起来)求值

## 产生错误消息 ##

编写Lisp代码时难免遇到错误，而Lisp解释器会在程序出错时输出报错信息。与其说是报错信息，不如说是有助的信息(书上这么说)。

下面，我们对一个没有引用并且第一个元素不是一个有意义的符号的列表进行求值。

``` emacs-lisp
(Just Error!) ;; => Symbol's function definition is void: Just
```
这个输出结果就像是出错了一样，它告诉我们Just符号命令没有定义。也就是说Lisp解释器视图将`(Just Error!)`当成类似`(+ 1 2)`这种列表进行求值，但由于后者的第一个元素"+"是有意义的(已定义)，不会有任何问题，而我们编写的列表中第一个元素"Just"是没有任何意义(未定义)的，Lisp解释器不知道怎么办了，只好告诉我们一些有用的信息。


## 符号名和函数定义 ##

我们已经讨论过一些符号或函数，例如"+"。就以"+"为例子，当我们对`(+ 2 2)`表达式求值时，计算机并不是执行的"+"这个命令，而是执行其对应的指令。我们甚至可以随意改变，例如我把"+"改为"Plus"。





## Lisp解释器 ##

下面，简单解释下Lisp解释器在对一个列表求值时做了些什么。
* 首先，检查列表前是否有单引号(quote)，如果有则直接返回这个列表的输出形式。
* 若没有单引号则查看列表的第一个元素，是否有相对应的函数定义，如果有则执行对应的指令。
* 若没有则提示错误消息。
以上就是Lisp解释器的工作方式。但都比较简单，下面将会介绍几种比较复杂的工作方式。

* 第一种。Lisp解释器还可以对符号求值(并不是只能对列表)，但这个符号前不能有单引号和被括号括起。
* 第二种，Lisp解释器在遇到一些特殊函数时。这些特殊的函数以特殊的方式运行着，这些特殊函数通常被称为特殊表(special form)。见名知意，它用于一些特殊的工作，例如定义函数之类的。
* 第三种，Lisp解释器在遇到一些不是特殊表，而是列表的一部分时。这可能意味着是一个嵌套列表，Lisp解释器首先查看列表中是否有另外一个列表，如果有则先解释内部列表，如果内部列表仍然具有一个列表，那么就再次解释更深的列表层级中的列表，最终以此返回结果。

否则Lisp解释器将会从左往右依次执行。

### 字节编译 ###

Lisp解释器还可以将Lisp代码编译成字节。这样的好处是可以让程序的执行速度更快，缺点是可读性几乎为零。

被编译成字节码后的源码叫做elc，可以通过命令`(byte-compile-file)`进行编译。


## 求值 ##


