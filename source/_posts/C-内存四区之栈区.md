---
title: C++内存四区之栈区
copyright: true
date: 2019-05-10 10:51:17
categories: 学习笔记
tags:
  - C++
---

# 什么是栈区

栈区是由编译器自动分配释放的内存区块，它可以用来存放局部变量，例如函数的参数值等..

# 操作栈区的注意事项

在函数的返回值类型为指针或引用时，不要返回栈区内的数据， 例如返回一个局部变量的地址．

因为所有局部的数据都是存放在栈区的，而栈区的内存是由编译器自动释放的，若在编译器已把某内存单元释放后，再对那个内存单元进行操作，则会报错．

~~~C++
#include <iostream>

using namespace std;
int *func(){
    //局部变量．存放在栈区,此变量将会在函数体执行完后自动释放．
    int a = 10;

    //尝试返回局部变量的地址
    return &a;
}
int main(){
    //接受func的返回值
    int *p = func();
    //输出p
    cout<<*p<<endl;
    return 0;
}
~~~

输出结果:

~~~
Process finished with exit code 139 (interrupted by signal 11: SIGSEGV)
~~~

上述代码中:func()函数的返回值类型为指针，并且它的返回值为函数体内部定义的变量a的地址，当这个函数被执行完，内部变量的内存空间将会被自动释放，所以在main函数内输出已经被释放的内存单元就会发生内存溢出的问题．

# 其他问题

可能有些编译器在第一次输出时可以正常输出，但如果是第二次输出则会报错,因为有些编译器会保留局部变量的值．

---
