---
title: Rust-理解所有权
copyright: true
date: 2019-07-30 03:11:46
categories: 学习笔记
tags:
 - Rust
---

根据Rust中文学习了些Rust的知识，所以记录下Rust中很重要的特性之一:所有权
<!--more-->

# 认识所有权

所有权是Rust最独特的功能，使得Rust不需要GC即可保证内存安全.

本篇文章介绍所有权及其相关功能：借用、slice，以及Rust如何在内存中布局数据

# 什么是所有权

所有权（ownership)是Rust的核心特性之一，其最大的特点是解决了目前大部分编程语言对内存管理方式的缺陷，例如:一些语言通过GC(垃圾回收机制)进行管理内存，在程序运行时不断的寻找无用的内存，但这种方式会使得程序的效率降低。另一种方式则是内存的分配和释放由程序员进行管理，所以经常会出现遗漏或设计缺陷，从而使得程序问题不断。而Rust的所有权特性则恰好解决了以上两个常见的问题。

在理解所有权之前，让我们先了解一个常用的数据结构:Stack Heap.

## 栈(Stack) 与 堆(Heap)

> 程序是由__算法__和__数据__组成的，`栈堆`这种数据结构则是一种处理数据的算法，而在所有权的概念中，数据是存在栈上还是堆上很大的影响了程序的行为。

`栈`的结构是一种后进先出的方式处理数据的，生活中的羽毛球例子可以清晰的描述这一关系:当我们将羽毛球放入羽毛球桶时，想要拿走时，总是拿走的最后一个放入的羽毛球，我们不能拿走最后一个放入之前的羽毛球。我们把放入羽毛球(增加数据)叫做__入栈__，拿出羽毛球(移出数据)叫做__出栈__。

__'栈'的优点是，速度快。这主要是因为如果要获取数据则总是从栈顶直接获取，而不需要寻找某个特定的位置需要读取数据。第二个原因是:栈中数据所占内存大小都已固定也可知。__

`堆`的结构是一种随机的方式处理数据的，生活中的例子每天吃饭可以清晰的描述这一关系:一日三餐，我们总是会想要吃什么，世界上有那么多美食，此时我们就需要选择想要的菜品才能进食，并且在要选择菜品时，我们还必须考虑是否有足够的金钱付款，而在我们选择菜品时是根据菜名通过服务员才能让厨房处理，最终上菜。我们把为菜品付款称作在__堆上分配内存__，而菜名称作__指针__，我们需要通过通过指针访问在堆上分配的内存.

__`堆`的优点是，不受限于只能获取最后一个存入的数据，因为数据都是成堆摆布的，如果需要访问需要通过指针__。

`堆`对数据的操作速度没有`栈`快，因为`堆`需要通过指针才能访问数据.

若数据大部分存在`堆`上，则有可能出现一些重复数据，为了清除这些无用的数据，确保内存空间不会被耗尽。这些问题正是所有权系统需要处理的。想必读者们也应该知道，所有权的存在就是为了管理堆数据的，当你理解了所有权后，将在编码时不用总考虑栈和堆了。

# 所有权规则

- Rust中，每一个值都有一个称为__所有者(owner)的变量。

- 值只能有一个所有者。

- 当所有者离开作用域，这个值则会被遗弃。

# 变量作用域

让我们看第一个关于所有权的例子

~~~
// 在这里使用s无效，s尚未生命
{
    let s = "hello"; // 从此处起，s 有效

}
// 在这里使用s无效，因为作用域已结束
~~~

这个例子中，当`s`进入作用域后，直到它离开作用域为止，它一直是有效的。

# `String`类型



