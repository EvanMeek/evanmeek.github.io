<!DOCTYPE html>
<html lang="en">
<head>
<<<<<<< HEAD
<!-- 2021-02-21 Sun 15:20 -->
=======
<!-- 2021-02-11 Thu 01:11 -->
>>>>>>> b352ff6ffc95cb29eb35064e50bd0e18d77c0398
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>C++菱形继承小记</title>
<meta name="generator" content="Org mode">
<meta name="author" content="Evan Meek">
<link rel="shortcut icon" href="/images/rose-red.png" type="image/x-icon" />
<link rel="stylesheet" href="/css/animate.min.css" />
<link rel="stylesheet" href="/css/all.min.css" />
<link rel="stylesheet" type="text/css" href="/css/style.css" />
<script src="/js/jquery.min.js"></script>
<script src="/js/darkreader.js"></script>
<script src="/js/main.js"></script>
</head>
<body>
<div id="content">
<h1 class="title">C++菱形继承小记</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org969f39f">多继承最明显的问题</a></li>
<li><a href="#orgc557e55">解决多继承带来的菱形继承问题</a></li>
<li><a href="#org468d786">最后</a></li>
</ul>
</div>
</div>
<p>
最近在复习C++，复习到多继承这个点上，由于多继承用的不多，以防自己以后忘记便有了这篇文章。
</p>

<div id="outline-container-org969f39f" class="outline-2">
<h2 id="org969f39f">多继承最明显的问题</h2>
<div class="outline-text-2" id="text-org969f39f">
<p>
我们直接用代码来说话，下面我们会创建多个类，让它们形成一个 <b><b>菱形继承</b></b> 的关系。
</p>

<div class="org-src-container">
<<<<<<< HEAD
<pre class="src src-cpp"><span style="color: #4078f2; font-weight: bold;">#include</span> <span style="color: #50a14f;">&lt;iostream&gt;</span>
<span style="color: #4078f2; font-weight: bold;">#include</span> <span style="color: #50a14f;">&lt;string&gt;</span>

<span style="color: #e45649;">using</span> <span style="color: #e45649;">namespace</span> <span style="color: #b751b6;">std</span>;

<span style="color: #e45649;">class</span> <span style="color: #986801;">A</span>
{
  <span style="color: #986801;">int</span> <span style="color: #6a1868;">a</span>;
<span style="color: #e45649;">public</span>:
  <span style="color: #a626a4;">A</span>(<span style="color: #986801;">int</span> <span style="color: #6a1868;">out_a</span>=10):<span style="color: #a626a4;">a</span>(out_a){
    cout &lt;&lt; <span style="color: #50a14f;">"A &#21019;&#24314;"</span> &lt;&lt;endl;
  }
};

<span style="color: #e45649;">class</span> <span style="color: #986801;">B</span>: <span style="color: #e45649;">public</span> <span style="color: #986801;">A</span>
{
  <span style="color: #986801;">int</span> <span style="color: #6a1868;">b</span>;
<span style="color: #e45649;">public</span>:
  <span style="color: #a626a4;">B</span>(<span style="color: #986801;">int</span> <span style="color: #6a1868;">out_b</span>=10):<span style="color: #a626a4;">b</span>(out_b){
    cout &lt;&lt; <span style="color: #50a14f;">"B &#21019;&#24314;"</span> &lt;&lt; endl;
  }
};

<span style="color: #e45649;">class</span> <span style="color: #986801;">C</span>: <span style="color: #e45649;">public</span> <span style="color: #986801;">A</span>
{
  <span style="color: #986801;">int</span> <span style="color: #6a1868;">c</span>;
<span style="color: #e45649;">public</span>:
  <span style="color: #a626a4;">C</span>(<span style="color: #986801;">int</span> <span style="color: #6a1868;">out_c</span>=10):<span style="color: #a626a4;">c</span>(out_c){
    cout &lt;&lt; <span style="color: #50a14f;">"C &#21019;&#24314;"</span> &lt;&lt; endl;
  }
};

<span style="color: #e45649;">class</span> <span style="color: #986801;">D</span>: <span style="color: #e45649;">public</span> <span style="color: #986801;">B</span>, <span style="color: #e45649;">public</span> <span style="color: #986801;">C</span>
{
  <span style="color: #986801;">int</span> <span style="color: #6a1868;">d</span>;
<span style="color: #e45649;">public</span>:
  <span style="color: #a626a4;">D</span>(<span style="color: #986801;">int</span> <span style="color: #6a1868;">out_d</span>=10):<span style="color: #a626a4;">d</span>(out_d){
    cout &lt;&lt; <span style="color: #50a14f;">"D &#21019;&#24314;"</span> &lt;&lt; endl;
=======
<pre class="src src-cpp"><span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #98be65;">&lt;iostream&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #98be65;">&lt;string&gt;</span>

<span style="color: #51afef;">using</span> <span style="color: #51afef;">namespace</span> <span style="color: #a9a1e1;">std</span>;

<span style="color: #51afef;">class</span> <span style="color: #ECBE7B;">A</span>
{
  <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">a</span>;
<span style="color: #51afef;">public</span>:
  <span style="color: #c678dd;">A</span>(<span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">out_a</span>=10):<span style="color: #c678dd;">a</span>(out_a){
    cout &lt;&lt; <span style="color: #98be65;">"A &#21019;&#24314;"</span> &lt;&lt;endl;
  }
};

<span style="color: #51afef;">class</span> <span style="color: #ECBE7B;">B</span>: <span style="color: #51afef;">public</span> <span style="color: #ECBE7B;">A</span>
{
  <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">b</span>;
<span style="color: #51afef;">public</span>:
  <span style="color: #c678dd;">B</span>(<span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">out_b</span>=10):<span style="color: #c678dd;">b</span>(out_b){
    cout &lt;&lt; <span style="color: #98be65;">"B &#21019;&#24314;"</span> &lt;&lt; endl;
  }
};

<span style="color: #51afef;">class</span> <span style="color: #ECBE7B;">C</span>: <span style="color: #51afef;">public</span> <span style="color: #ECBE7B;">A</span>
{
  <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">c</span>;
<span style="color: #51afef;">public</span>:
  <span style="color: #c678dd;">C</span>(<span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">out_c</span>=10):<span style="color: #c678dd;">c</span>(out_c){
    cout &lt;&lt; <span style="color: #98be65;">"C &#21019;&#24314;"</span> &lt;&lt; endl;
  }
};

<span style="color: #51afef;">class</span> <span style="color: #ECBE7B;">D</span>: <span style="color: #51afef;">public</span> <span style="color: #ECBE7B;">B</span>, <span style="color: #51afef;">public</span> <span style="color: #ECBE7B;">C</span>
{
  <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">d</span>;
<span style="color: #51afef;">public</span>:
  <span style="color: #c678dd;">D</span>(<span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">out_d</span>=10):<span style="color: #c678dd;">d</span>(out_d){
    cout &lt;&lt; <span style="color: #98be65;">"D &#21019;&#24314;"</span> &lt;&lt; endl;
>>>>>>> b352ff6ffc95cb29eb35064e50bd0e18d77c0398
  }
};


<<<<<<< HEAD
<span style="color: #986801;">int</span> <span style="color: #a626a4;">main</span>()
{
  <span style="color: #986801;">D</span> <span style="color: #6a1868;">d</span>;
=======
<span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">main</span>()
{
  <span style="color: #ECBE7B;">D</span> <span style="color: #dcaeea;">d</span>;
>>>>>>> b352ff6ffc95cb29eb35064e50bd0e18d77c0398
}

</pre>
</div>

<p>
这边用文字简单描述下它们的关系，首先有个基类 <b><b>A</b></b> ，然后有两个由 <b><b>A</b></b> 派生类 <b><b>B</b></b> 和 <b><b>C</b></b> ，然后有一个由类 <b><b>B</b></b> 和类 <b><b>C</b></b> 派生的类 <b><b>D</b></b> 。
</p>

<p>
这就是 <b><b>菱形继承</b></b> 了，其运行结果如下:
</p>

<div class="org-src-container">
<pre class="src src-shell">A &#21019;&#24314;
B &#21019;&#24314;
A &#21019;&#24314;
C &#21019;&#24314;
D &#21019;&#24314;
</pre>
</div>

<p>
我们发现，其中 <b><b>A</b></b> 类的构造函数被执行了两次，这就是因为 <b><b>D</b></b> 两个基类都继承于类 <b><b>A</b></b> 所以就会造成这样的问题啦
</p>
</div>
</div>

<div id="outline-container-orgc557e55" class="outline-2">
<h2 id="orgc557e55">解决多继承带来的菱形继承问题</h2>
<div class="outline-text-2" id="text-orgc557e55">
<p>
那么要如何解决呢？其实也很简单，只需要将 <b><b>D</b></b> 类的两个父类所继承的位置添加一个 <b><b>virtual</b></b> 关键字就可以解决这个问题。
</p>

<p>
就像这样:
</p>

<div class="org-src-container">
<<<<<<< HEAD
<pre class="src src-cpp"><span style="color: #4078f2; font-weight: bold;">#include</span> <span style="color: #50a14f;">&lt;iostream&gt;</span>
<span style="color: #4078f2; font-weight: bold;">#include</span> <span style="color: #50a14f;">&lt;string&gt;</span>

<span style="color: #e45649;">using</span> <span style="color: #e45649;">namespace</span> <span style="color: #b751b6;">std</span>;

<span style="color: #e45649;">class</span> <span style="color: #986801;">A</span>
{
  <span style="color: #986801;">int</span> <span style="color: #6a1868;">a</span>;
<span style="color: #e45649;">public</span>:
  <span style="color: #a626a4;">A</span>(<span style="color: #986801;">int</span> <span style="color: #6a1868;">out_a</span>=10):<span style="color: #a626a4;">a</span>(out_a){
    cout &lt;&lt; <span style="color: #50a14f;">"A &#21019;&#24314;"</span> &lt;&lt;endl;
  }
};

<span style="color: #e45649;">class</span> <span style="color: #986801;">B</span>: <span style="color: #e45649;">virtual</span> <span style="color: #e45649;">public</span> <span style="color: #986801;">A</span>
{
  <span style="color: #986801;">int</span> <span style="color: #6a1868;">b</span>;
<span style="color: #e45649;">public</span>:
  <span style="color: #a626a4;">B</span>(<span style="color: #986801;">int</span> <span style="color: #6a1868;">out_b</span>=10):<span style="color: #a626a4;">b</span>(out_b){
    cout &lt;&lt; <span style="color: #50a14f;">"B &#21019;&#24314;"</span> &lt;&lt; endl;
  }
};

<span style="color: #e45649;">class</span> <span style="color: #986801;">C</span>: <span style="color: #e45649;">virtual</span> <span style="color: #e45649;">public</span> <span style="color: #986801;">A</span>
{
  <span style="color: #986801;">int</span> <span style="color: #6a1868;">c</span>;
<span style="color: #e45649;">public</span>:
  <span style="color: #a626a4;">C</span>(<span style="color: #986801;">int</span> <span style="color: #6a1868;">out_c</span>=10):<span style="color: #a626a4;">c</span>(out_c){
    cout &lt;&lt; <span style="color: #50a14f;">"C &#21019;&#24314;"</span> &lt;&lt; endl;
  }
};

<span style="color: #e45649;">class</span> <span style="color: #986801;">D</span>: <span style="color: #e45649;">public</span> <span style="color: #986801;">B</span>, <span style="color: #e45649;">public</span> <span style="color: #986801;">C</span>
{
  <span style="color: #986801;">int</span> <span style="color: #6a1868;">d</span>;
<span style="color: #e45649;">public</span>:
  <span style="color: #a626a4;">D</span>(<span style="color: #986801;">int</span> <span style="color: #6a1868;">out_d</span>=10):<span style="color: #a626a4;">d</span>(out_d){
    cout &lt;&lt; <span style="color: #50a14f;">"D &#21019;&#24314;"</span> &lt;&lt; endl;
=======
<pre class="src src-cpp"><span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #98be65;">&lt;iostream&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #98be65;">&lt;string&gt;</span>

<span style="color: #51afef;">using</span> <span style="color: #51afef;">namespace</span> <span style="color: #a9a1e1;">std</span>;

<span style="color: #51afef;">class</span> <span style="color: #ECBE7B;">A</span>
{
  <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">a</span>;
<span style="color: #51afef;">public</span>:
  <span style="color: #c678dd;">A</span>(<span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">out_a</span>=10):<span style="color: #c678dd;">a</span>(out_a){
    cout &lt;&lt; <span style="color: #98be65;">"A &#21019;&#24314;"</span> &lt;&lt;endl;
  }
};

<span style="color: #51afef;">class</span> <span style="color: #ECBE7B;">B</span>: <span style="color: #51afef;">virtual</span> <span style="color: #51afef;">public</span> <span style="color: #ECBE7B;">A</span>
{
  <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">b</span>;
<span style="color: #51afef;">public</span>:
  <span style="color: #c678dd;">B</span>(<span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">out_b</span>=10):<span style="color: #c678dd;">b</span>(out_b){
    cout &lt;&lt; <span style="color: #98be65;">"B &#21019;&#24314;"</span> &lt;&lt; endl;
  }
};

<span style="color: #51afef;">class</span> <span style="color: #ECBE7B;">C</span>: <span style="color: #51afef;">virtual</span> <span style="color: #51afef;">public</span> <span style="color: #ECBE7B;">A</span>
{
  <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">c</span>;
<span style="color: #51afef;">public</span>:
  <span style="color: #c678dd;">C</span>(<span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">out_c</span>=10):<span style="color: #c678dd;">c</span>(out_c){
    cout &lt;&lt; <span style="color: #98be65;">"C &#21019;&#24314;"</span> &lt;&lt; endl;
  }
};

<span style="color: #51afef;">class</span> <span style="color: #ECBE7B;">D</span>: <span style="color: #51afef;">public</span> <span style="color: #ECBE7B;">B</span>, <span style="color: #51afef;">public</span> <span style="color: #ECBE7B;">C</span>
{
  <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">d</span>;
<span style="color: #51afef;">public</span>:
  <span style="color: #c678dd;">D</span>(<span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">out_d</span>=10):<span style="color: #c678dd;">d</span>(out_d){
    cout &lt;&lt; <span style="color: #98be65;">"D &#21019;&#24314;"</span> &lt;&lt; endl;
>>>>>>> b352ff6ffc95cb29eb35064e50bd0e18d77c0398
  }
};


<<<<<<< HEAD
<span style="color: #986801;">int</span> <span style="color: #a626a4;">main</span>()
{
  <span style="color: #986801;">D</span> <span style="color: #6a1868;">d</span>;
=======
<span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">main</span>()
{
  <span style="color: #ECBE7B;">D</span> <span style="color: #dcaeea;">d</span>;
>>>>>>> b352ff6ffc95cb29eb35064e50bd0e18d77c0398
}
</pre>
</div>

<p>
其运行结果如下:
</p>

<div class="org-src-container">
<pre class="src src-shell">A &#21019;&#24314;
B &#21019;&#24314;
C &#21019;&#24314;
D &#21019;&#24314;
</pre>
</div>

<p>
我们发现 <b><b>A</b></b> 类的构造函数只被执行了一次，也就解决这个问题啦。
</p>
</div>
</div>

<div id="outline-container-org468d786" class="outline-2">
<h2 id="org468d786">最后</h2>
<div class="outline-text-2" id="text-org468d786">
<p>
最后由于我现在写C++代码也不多，所以也不知道这个多继承的应用场景，可能是想更方便进行代码复用和提高执行效率吧。。
</p>

<p>
不过感觉这样有些得不偿失，会让程序变得复杂不少。
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: 2020-07-16 Thu 00:00</p>
<p class="author">Author: Evan Meek</p>
<<<<<<< HEAD
<p class="date">Created: 2021-02-21 Sun 15:20</p>
=======
<p class="date">Created: 2021-02-11 Thu 01:11</p>
>>>>>>> b352ff6ffc95cb29eb35064e50bd0e18d77c0398
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
